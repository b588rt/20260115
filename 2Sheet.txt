
Sub CompareAndDeleteRows()

    Dim ws3 As Worksheet, ws4 As Worksheet
    Dim lastRow3 As Long, lastRow4 As Long
    Dim colXuebie As Long, colXuehao As Long
    Dim i As Long, j As Long
    Dim matchFound As Boolean
    
    Set ws3 = ThisWorkbook.Worksheets("工作表3")
    Set ws4 = ThisWorkbook.Worksheets("工作表4")
    
  
    For colXuebie = 1 To 26 
        If InStr(1, ws4.Cells(1, colXuebie).Value, "學別p") > 0 Then
            ws4.Cells(1, colXuebie).Interior.Color = RGB(255, 255, 0) 
            Exit For
        End If
    Next colXuebie
    
    If colXuebie > 26 Then
       
        Exit Sub
    End If
    
    For colXuehao = 1 To 26 ' A到Z欄
        If InStr(1, ws3.Cells(1, colXuehao).Value, "學號h") > 0 Then
            ws3.Cells(1, colXuehao).Interior.Color = RGB(0, 255, 0) 
            Exit For
        End If
    Next colXuehao
    
    If colXuehao > 26 Then
      
        Exit Sub
    End If
    
  
    lastRow4 = ws4.Cells(ws4.Rows.Count, colXuebie).End(xlUp).Row
    
  
    i = 2 
    lastRow3 = ws3.Cells(ws3.Rows.Count, colXuehao).End(xlUp).Row
    
    Do While i <= lastRow3
       
        If Trim(ws3.Cells(i, colXuehao).Value) = "" Then
            Exit Do
        End If
        
        matchFound = False
        
      
        For j = 2 To lastRow4
            If ws3.Cells(i, colXuehao).Value = ws4.Cells(j, colXuebie).Value Then
                matchFound = True
                Exit For
            End If
        Next j
        
    
        If Not matchFound Then
            ws3.Rows(i).Delete
            lastRow3 = lastRow3 - 1 
        Else
            i = i + 1 
        End If
    Loop
    
   
End Sub

Function ColLetter(colNumber As Long) As String
    Dim vArr
    vArr = Split(Cells(1, colNumber).Address(True, False), "$")
    ColLetter = vArr(0)
End Function

